require=function s(r,a,h){function c(i,t){if(!a[i]){if(!r[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(l)return l(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var o=a[i]={exports:{}};r[i][0].call(o.exports,function(t){return c(r[i][1][t]||t)},o,o.exports,s,r,a,h)}return a[i].exports}for(var l="function"==typeof require&&require,t=0;t<h.length;t++)c(h[t]);return c}({CameraFollow:[function(t,i,e){"use strict";cc._RF.push(i,"d8feaqc5KdBeqSRYmxe6ZE3","CameraFollow"),cc.Class({extends:cc.Component,properties:{speed:cc.Float,knife:cc.Node},start:function(){this.threshold=this.knife.y},update:function(t){1<cc.pDistance(this.node.position,cc.v2(0,this.threshold+470))&&(this.node.position=cc.pLerp(this.node.position,cc.v2(0,this.threshold+470),this.speed*t))},move:function(){this.threshold=this.knife.y}}),cc._RF.pop()},{}],FruitSpawner:[function(t,i,e){"use strict";cc._RF.push(i,"54557eRg5tGX7eZTYa/uRw1","FruitSpawner"),cc.Class({extends:cc.Component,properties:{fruits:{default:[],type:cc.Prefab},fruitParent:cc.Node,knife:cc.Node,upDownSpeed:2,upDownThreshold:.2,upDownThresholdIncreamentAmount:.1,fruitFallingGravity:2,defaultSprite:cc.SpriteFrame,hittedSprite:cc.SpriteFrame,splashPrefab:cc.Prefab},start:function(){this.knifeComponent=this.knife.getComponent("Knife"),this.minimumHorizontalMargin=120,this.maximumHorizontalMargin=280,this.currentHorizontalMargin=this.maximumHorizontalMargin,this.initialUpDownThreshold=this.upDownThreshold,this.addFrutisToPool(),this.addSplashesToPool()},addFrutisToPool:function(){this.pools=[];for(var t=null,i=0,e=this.fruits.length;i<e;i++){this.pools.push(new cc.NodePool("myPool"+i.toString()));for(var n=0;n<5;n++){var o=(t=cc.instantiate(this.fruits[i])).getComponent("Fruit");o.poolIndex=i,o.setDefaults(this),this.pools[i].put(t)}}},addSplashesToPool:function(){this.splashPool=new cc.NodePool("splashPool");for(var t=0;t<10;t++){var i=cc.instantiate(this.splashPrefab);this.splashPool.put(i),i.getComponent("Splash").onAddedToPool(this),i.zIndex=-1}},spawnSplash:function(t,i){var e=this.splashPool.get();e.parent=this.fruitParent,e.position=cc.v2(this.randomRangeFloat(t.x-50,t.x+50),this.randomRangeFloat(t.y-50,t.y+50)),e.rotation=this.randomRangeInt(0,360),(this.lastSpawnedSplash=e).getComponent("Splash").onSpawn(i)},increase:function(){this.currentHorizontalMargin>this.minimumHorizontalMargin&&(this.currentHorizontalMargin-=20),this.upDownThreshold+=this.upDownThresholdIncreamentAmount},spawnFruit:function(){var t=this.pools[this.randomRangeInt(0,this.fruits.length)].get();t.parent=this.fruitParent,t.getComponent("Fruit").onSpawn();var i=this.knife.convertToWorldSpaceAR(cc.Vec2.ZERO),e=i.x-250,n=i.x+250,o=e>=this.currentHorizontalMargin,s=n<=cc.Canvas.instance.node.width-this.currentHorizontalMargin,r=2;r=o&&s?this.randomRangeInt(0,2):r;var a=0,h=i.y+700;0==(r=2==r?o?0:1:r)?(a=this.randomRangeFloat(this.currentHorizontalMargin,e),this.knifeComponent.rotateSpeed<0&&(this.knifeComponent.rotateSpeed*=-1)):1==r&&(a=this.randomRangeFloat(n,cc.Canvas.instance.node.width-this.currentHorizontalMargin),0<this.knifeComponent.rotateSpeed&&(this.knifeComponent.rotateSpeed*=-1)),t.position=this.fruitParent.convertToNodeSpaceAR(cc.v2(a,h))},randomRangeInt:function(t,i){return Math.floor(this.randomRangeFloat(t,i))},randomRangeFloat:function(t,i){return Math.random()*(i-t)+t},returnToFruitPool:function(t){this.pools[t.getComponent("Fruit").poolIndex].put(t)},returnToSplashPool:function(t){this.splashPool.put(t)},returnExistingFruitsAndSplashes:function(){for(var t=0,i=this.fruitParent.children;t<i.length;t++)"fruit"==i[t].group?this.pools[i[t].getComponent("Fruit").poolIndex].put(i[t]):this.splashPool.put(i[t]);cc.log(this.fruitParent.children)}}),cc._RF.pop()},{}],Fruit:[function(t,i,e){"use strict";cc._RF.push(i,"eace1ZBvRdEZb363Ilk+Pmk","Fruit"),cc.Class({extends:cc.Component,properties:{temp:{default:0,visible:function(){return!1}},poolIndex:{default:0,visible:function(){return!1}},fruitSpawner:{default:null,visible:function(){return!1}},splashColor:cc.Color,faceSprite:cc.Sprite},setDefaults:function(t){this.fruitSpawner=t,this.initialScaleX=this.node.scaleX,this.initialScaleY=this.node.scaleY,this.keepMoving=!1,this.fallDown=!1,this.isHitted=!1,this.temp=0},onSpawn:function(){this.node.scaleX=.07,this.node.scaleY=.07,this.keepMoving=!0,this.isHitted=!1,this.fallDown=!1,this.temp=0,this.faceSprite.spriteFrame=this.fruitSpawner.defaultSprite;var t=cc.scaleTo(.3,this.initialScaleX,this.initialScaleY);this.node.runAction(t)},onHitByKnife:function(){this.keepMoving=!1,this.isHitted=!0,this.faceSprite.spriteFrame=this.fruitSpawner.hittedSprite},update:function(t){this.keepMoving?(this.temp+=this.fruitSpawner.upDownSpeed*t,this.node.y+=Math.sin(this.temp)*this.fruitSpawner.upDownThreshold):this.fallDown&&(this.temp-=this.fruitSpawner.fruitFallingGravity*t,this.node.y+=this.temp*t)},onFallDown:function(){this.fruitSpawner.returnToFruitPool(this.node)},onCollisionEnter:function(t,i){2==t.tag&&this.onFallDown()}}),cc._RF.pop()},{}],Knife:[function(t,i,e){"use strict";cc._RF.push(i,"9da89QGLIlHvbPihZCY1XMR","Knife"),cc.Class({extends:cc.Component,properties:{touchDetector:cc.Node,jumpForce:cc.Float,gravity:cc.Float,rotateSpeed:cc.Float,hitSpeed:cc.Float,fruitSpawnerNode:cc.Node},onLoad:function(){cc.director.getCollisionManager().enabled=!0},start:function(){this.goForHit=!1,this.knifeInitialPos=this.node.y,this.jump=!1,this.yPos=this.node.y,this.lookAtPoint={},this.cameraFollow=cc.Camera.main.node.getComponent("CameraFollow"),this.fruitSpawner=this.fruitSpawnerNode.getComponent("FruitSpawner"),this.uiManager=this.fruitSpawnerNode.getComponent("UIManager"),this.hittedFruit=null},registerEvents:function(){var t=this;this.touchDetector.setContentSize(cc.Canvas.instance.node.getContentSize()),this.touchDetector.on("touchstart",function(){t.onMouseDown()}),this.touchDetector.on("touchend",function(){t.onMouseUp()})},onMouseDown:function(){this.goForHit||(this.jump=!0),this.yPos=this.jumpForce,this.hittedFruit&&(this.hittedFruit.getComponent("Fruit").fallDown=!0,this.fruitSpawner.lastSpawnedSplash.getComponent("Splash").fadeOut(),this.hittedFruit=null)},onMouseUp:function(){this.jump=!1,this.goForHit=!0;var t=(this.node.rotation+90)*(Math.PI/180);this.lookAtPoint.x=Math.cos(-t),this.lookAtPoint.y=Math.sin(-t)},onCollisionEnter:function(t,i){1==t.tag?(this.goForHit=!1,t.node.getComponent("Fruit").isHitted||(this.hittedFruit=t.node,this.hittedFruit.getComponent("Fruit").onHitByKnife(),this.cameraFollow.move(),this.uiManager.increaseScore(),this.fruitSpawner.spawnFruit(),this.fruitSpawner.spawnSplash(t.node.position,t.node.getComponent("Fruit").splashColor))):2==t.tag?this.onDeath():3==t.tag&&(t.enabled=!1,this.uiManager.cycleBGs(t.node))},checkForDeath:function(){var t=this.node.convertToWorldSpaceAR(cc.Vec2.ZERO),i=cc.Camera.main.node.convertToWorldSpaceAR(cc.Vec2.ZERO),e=cc.Canvas.instance.node.height/2;(t.y>e+i.y+150||t.y<i.y-e-150||t.x>cc.Canvas.instance.node.width/2+150+i.x||t.x<-150)&&this.onDeath()},onDeath:function(){this.goForHit=!1,this.goForHit=!1,this.touchDetector.off("mousedown"),this.touchDetector.off("mouseup"),this.uiManager.retryPanel.active=!0,console.log("death")},reset:function(){this.node.y=this.knifeInitialPos,this.node.x=0,this.node.rotation=0,this.fruitSpawner.returnExistingFruitsAndSplashes(),this.uiManager.decorateBGs(),this.cameraFollow.move(),cc.Camera.main.node.y=0},update:function(t){if(this.jump)this.yPos-=this.gravity*t,this.node.y+=this.yPos,this.node.rotation+=this.rotateSpeed*t;else if(this.goForHit){var i=this.hitSpeed*t;this.node.x+=this.lookAtPoint.x*i,this.node.y+=this.lookAtPoint.y*i}}}),cc._RF.pop()},{}],Splash:[function(t,i,e){"use strict";cc._RF.push(i,"03ff2A42PFOoqbBbYEAzEPJ","Splash"),cc.Class({extends:cc.Component,properties:{splashes:{default:[],type:cc.Node}},onAddedToPool:function(t){this.fruitSpawner=t,this.scaleUp=!1,this.isFadeOut=!1},onSpawn:function(t){for(var i=0;i<3;i++)this.splashes[i].setScale(0,0),this.splashes[i].color=t;this.scaleUp=!0},fadeOut:function(){var t=this;setTimeout(function(){t.isFadeOut=!0},1e3)},onCollisionEnter:function(t,i){2==t.tag&&(this.node.opacity=255,this.scaleUp=!1,this.isFadeOut=!1,this.fruitSpawner.returnToSplashPool(this.node))},update:function(t){if(this.splashes[0].scaleX<.95)for(var i=cc.lerp(this.splashes[0].scaleX,1,7*t),e=0;e<3;e++)this.splashes[e].setScale(i,i);else this.isFadeOut&&1<this.node.opacity&&(this.node.opacity=cc.lerp(this.node.opacity,0,2*t))}}),cc._RF.pop()},{}],UIManager:[function(t,i,e){"use strict";cc._RF.push(i,"7a592QOeLxN6IlJF5hWhLZm","UIManager"),cc.Class({extends:cc.Component,properties:{score:{default:0,visible:function(){return!1}},playPanel:cc.Node,retryPanel:cc.Node},increaseScore:function(){this.score++,this.score%3==0&&this.fruitSpawner.increase()},start:function(){this.startCycle=!1,this.BGs=cc.Canvas.instance.node.children[0].children,this.canvasHeight=cc.Canvas.instance.node.height,this.fruitSpawner=this.node.getComponent("FruitSpawner"),this.decorateBGs(),window.Global&&window.Global.isReplay&&this.play()},decorateBGs:function(){this.BGs[0].y=0;for(var t=1;t<this.BGs.length;t++)this.BGs[t].y=this.BGs[t-1].y+this.canvasHeight},cycleBGs:function(t){if(this.startCycle){var i=this.BGs.shift();i.y=this.BGs[this.BGs.length-1].y+this.canvasHeight,i.getComponent(cc.Collider).enabled=!0,this.BGs.push(i)}else 1==this.BGs.indexOf(t)&&(this.startCycle=!0)},play:function(){var t=this;window.Global={},window.Global.isReplay=!1,this.fruitSpawner.spawnFruit(),this.playPanel.active=!1,setTimeout(function(){t.fruitSpawner.knife.getComponent("Knife").registerEvents()},200)},retry:function(){window.Global.isReplay=!0,cc.director.loadScene("1st")}}),cc._RF.pop()},{}]},{},["CameraFollow","Fruit","FruitSpawner","Knife","Splash","UIManager"]);